<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZKP Accelerator - Paper Analysis & Circuit Compiler</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        @keyframes flow { 0% { transform: translateX(0); } 100% { transform: translateX(10px); } }
        @keyframes compile { 0% { opacity: 0; transform: translateY(-10px); } 100% { opacity: 1; transform: translateY(0); } }
        .animate-pulse-slow { animation: pulse 2s ease-in-out infinite; }
        .animate-flow { animation: flow 0.5s ease-in-out infinite alternate; }
        .animate-compile { animation: compile 0.3s ease-out forwards; }
        .glow { filter: drop-shadow(0 0 8px currentColor); }
        .code-font { font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace; }
    </style>
</head>
<body class="bg-gray-900 text-white">
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // ============================================================
        // PAPER FIGURE: zkSpeed Figure 9 - Cycle Breakdown
        // ============================================================
        const ZkSpeedFigure9 = () => {
            const [problemSize, setProblemSize] = useState(20);
            const [bandwidth, setBandwidth] = useState(2000);
            
            // Model based on paper's analysis
            const n = 2 ** problemSize;
            const degree = 4; // Vanilla
            const numMLEs = 3;
            
            // Cycle estimates (simplified model matching paper trends)
            const extensionCycles = n * (degree + 1) * 2;
            const productCycles = n * numMLEs * 3;
            const updateCycles = n * numMLEs;
            const memoryCycles = (n * 32 * numMLEs) / (bandwidth * 1e9 / 8) * 1e9;
            
            const totalCompute = extensionCycles + productCycles + updateCycles;
            const totalCycles = Math.max(totalCompute, memoryCycles);
            
            const extPct = (extensionCycles / totalCycles) * 100;
            const prodPct = (productCycles / totalCycles) * 100;
            const updatePct = (updateCycles / totalCycles) * 100;
            const memPct = (memoryCycles / totalCycles) * 100;
            
            const isMemoryBound = memoryCycles > totalCompute;

            return (
                <div className="p-6 bg-gray-800 rounded-xl">
                    <div className="flex justify-between items-start mb-4">
                        <div>
                            <h2 className="text-2xl font-bold text-blue-400">zkSpeed Figure 9: Cycle Breakdown</h2>
                            <p className="text-gray-400 text-sm">Reproducing the paper's SumCheck cycle analysis</p>
                        </div>
                        <div className="text-xs bg-blue-900 px-3 py-1 rounded">REPRODUCTION</div>
                    </div>
                    
                    {/* Controls */}
                    <div className="grid grid-cols-2 gap-4 mb-6">
                        <div>
                            <label className="block text-sm text-gray-400 mb-1">
                                Problem Size: 2^{problemSize} = {n.toLocaleString()} gates
                            </label>
                            <input 
                                type="range" min="16" max="24" value={problemSize}
                                onChange={(e) => setProblemSize(Number(e.target.value))}
                                className="w-full"
                            />
                        </div>
                        <div>
                            <label className="block text-sm text-gray-400 mb-1">
                                HBM Bandwidth: {bandwidth} GB/s
                            </label>
                            <input 
                                type="range" min="500" max="4000" step="100" value={bandwidth}
                                onChange={(e) => setBandwidth(Number(e.target.value))}
                                className="w-full"
                            />
                        </div>
                    </div>

                    {/* Stacked bar chart */}
                    <div className="mb-6">
                        <div className="text-sm text-gray-400 mb-2">Cycle Distribution</div>
                        <div className="h-16 flex rounded-lg overflow-hidden">
                            <div 
                                className="bg-blue-500 flex items-center justify-center text-xs font-semibold transition-all"
                                style={{ width: `${extPct}%` }}
                                title="Extension Computation"
                            >
                                {extPct > 10 && 'Extension'}
                            </div>
                            <div 
                                className="bg-green-500 flex items-center justify-center text-xs font-semibold transition-all"
                                style={{ width: `${prodPct}%` }}
                                title="Product Computation"
                            >
                                {prodPct > 10 && 'Product'}
                            </div>
                            <div 
                                className="bg-yellow-500 flex items-center justify-center text-xs font-semibold text-black transition-all"
                                style={{ width: `${updatePct}%` }}
                                title="MLE Update"
                            >
                                {updatePct > 10 && 'Update'}
                            </div>
                            <div 
                                className="bg-pink-500 flex items-center justify-center text-xs font-semibold transition-all"
                                style={{ width: `${Math.min(memPct, 100 - extPct - prodPct - updatePct)}%` }}
                                title="Memory Stalls"
                            >
                                {memPct > 15 && 'Memory'}
                            </div>
                        </div>
                        <div className="flex justify-between mt-2 text-xs text-gray-400">
                            <div className="flex items-center gap-1"><div className="w-3 h-3 bg-blue-500 rounded"></div> Extension</div>
                            <div className="flex items-center gap-1"><div className="w-3 h-3 bg-green-500 rounded"></div> Product</div>
                            <div className="flex items-center gap-1"><div className="w-3 h-3 bg-yellow-500 rounded"></div> Update</div>
                            <div className="flex items-center gap-1"><div className="w-3 h-3 bg-pink-500 rounded"></div> Memory</div>
                        </div>
                    </div>

                    {/* Metrics */}
                    <div className="grid grid-cols-4 gap-4 mb-6">
                        <div className="bg-gray-700 p-3 rounded-lg text-center">
                            <div className="text-xs text-gray-400">Total Cycles</div>
                            <div className="text-lg font-bold">{(totalCycles / 1e6).toFixed(1)}M</div>
                        </div>
                        <div className="bg-gray-700 p-3 rounded-lg text-center">
                            <div className="text-xs text-gray-400">Runtime</div>
                            <div className="text-lg font-bold">{(totalCycles / 1e9 * 1000).toFixed(2)}ms</div>
                        </div>
                        <div className="bg-gray-700 p-3 rounded-lg text-center">
                            <div className="text-xs text-gray-400">Throughput</div>
                            <div className="text-lg font-bold">{(n / (totalCycles / 1e9) / 1e6).toFixed(1)}M/s</div>
                        </div>
                        <div className={`p-3 rounded-lg text-center ${isMemoryBound ? 'bg-pink-900' : 'bg-blue-900'}`}>
                            <div className="text-xs text-gray-400">Bottleneck</div>
                            <div className="text-lg font-bold">{isMemoryBound ? 'MEMORY' : 'COMPUTE'}</div>
                        </div>
                    </div>

                    {/* Paper insight */}
                    <div className="p-4 bg-gray-700 rounded-lg text-sm">
                        <p className="text-yellow-400 font-semibold mb-2">üìÑ Paper Finding (zkSpeed Section 5.2):</p>
                        <p className="text-gray-300">
                            "At typical HBM bandwidths (2TB/s), vanilla ZeroCheck is <span className="text-pink-400">memory-bound</span>. 
                            Extension and product computations are fast enough that memory bandwidth becomes the limiting factor.
                            This motivates our streaming architecture design."
                        </p>
                    </div>
                </div>
            );
        };

        // ============================================================
        // PAPER FIGURE: zkPHIRE Figure 11 - Speedup vs Degree
        // ============================================================
        const ZkPHIREFigure11 = () => {
            const [selectedDegree, setSelectedDegree] = useState(7);
            
            // Data points modeling paper's figure
            const dataPoints = [
                { degree: 4, vanilla: 1.0, jellyfish: 0.42, label: 'Vanilla' },
                { degree: 5, vanilla: 1.0, jellyfish: 0.50, label: '' },
                { degree: 6, vanilla: 1.0, jellyfish: 0.58, label: '' },
                { degree: 7, vanilla: 1.0, jellyfish: 0.70, label: 'Jellyfish' },
                { degree: 8, vanilla: 1.0, jellyfish: 0.75, label: '' },
                { degree: 10, vanilla: 1.0, jellyfish: 0.85, label: '' },
                { degree: 12, vanilla: 1.0, jellyfish: 0.95, label: '' },
                { degree: 14, vanilla: 1.0, jellyfish: 1.05, label: '' },
                { degree: 16, vanilla: 1.0, jellyfish: 1.15, label: '' },
                { degree: 18, vanilla: 1.0, jellyfish: 1.25, label: 'Crossover' },
                { degree: 20, vanilla: 1.0, jellyfish: 1.35, label: '' },
            ];

            // With gate reduction applied
            const withReduction = dataPoints.map(p => ({
                ...p,
                // Higher degree = more gate reduction potential
                effectiveSpeedup: p.jellyfish * (1 + (p.degree - 4) * 0.3)
            }));

            const maxY = 3;
            const chartHeight = 200;
            const chartWidth = 500;

            return (
                <div className="p-6 bg-gray-800 rounded-xl">
                    <div className="flex justify-between items-start mb-4">
                        <div>
                            <h2 className="text-2xl font-bold text-purple-400">zkPHIRE Figure 11: Speedup Analysis</h2>
                            <p className="text-gray-400 text-sm">Per-gate cost vs effective speedup with gate reduction</p>
                        </div>
                        <div className="text-xs bg-purple-900 px-3 py-1 rounded">REPRODUCTION</div>
                    </div>

                    {/* Chart */}
                    <div className="bg-gray-700 p-4 rounded-lg mb-6">
                        <svg width="100%" height={chartHeight + 60} viewBox={`0 0 ${chartWidth + 100} ${chartHeight + 60}`}>
                            {/* Axes */}
                            <line x1="60" y1={chartHeight + 10} x2={chartWidth + 60} y2={chartHeight + 10} className="stroke-gray-500" strokeWidth="2" />
                            <line x1="60" y1="10" x2="60" y2={chartHeight + 10} className="stroke-gray-500" strokeWidth="2" />
                            
                            {/* Y-axis labels */}
                            {[0, 1, 2, 3].map(v => (
                                <g key={v}>
                                    <text x="50" y={chartHeight + 10 - (v / maxY) * chartHeight + 5} className="fill-gray-400 text-xs" textAnchor="end">{v}x</text>
                                    <line x1="55" y1={chartHeight + 10 - (v / maxY) * chartHeight} x2="60" y2={chartHeight + 10 - (v / maxY) * chartHeight} className="stroke-gray-500" />
                                </g>
                            ))}
                            
                            {/* X-axis labels */}
                            {dataPoints.filter((_, i) => i % 2 === 0).map((p, i) => (
                                <text key={i} x={60 + (p.degree - 4) * 25 + 12} y={chartHeight + 30} className="fill-gray-400 text-xs" textAnchor="middle">d={p.degree}</text>
                            ))}
                            
                            {/* 1x reference line */}
                            <line x1="60" y1={chartHeight + 10 - (1 / maxY) * chartHeight} x2={chartWidth + 60} y2={chartHeight + 10 - (1 / maxY) * chartHeight} className="stroke-gray-600" strokeDasharray="5,5" />
                            <text x={chartWidth + 70} y={chartHeight + 10 - (1 / maxY) * chartHeight + 4} className="fill-gray-500 text-xs">break-even</text>

                            {/* Per-gate cost line (red - shows Jellyfish is slower per gate) */}
                            <polyline 
                                points={dataPoints.map((p, i) => `${60 + (p.degree - 4) * 25 + 12},${chartHeight + 10 - (p.jellyfish / maxY) * chartHeight}`).join(' ')}
                                fill="none"
                                className="stroke-red-400"
                                strokeWidth="2"
                            />
                            {dataPoints.map((p, i) => (
                                <circle 
                                    key={`red-${i}`}
                                    cx={60 + (p.degree - 4) * 25 + 12}
                                    cy={chartHeight + 10 - (p.jellyfish / maxY) * chartHeight}
                                    r={p.degree === selectedDegree ? 6 : 4}
                                    className="fill-red-400 cursor-pointer"
                                    onClick={() => setSelectedDegree(p.degree)}
                                />
                            ))}

                            {/* Effective speedup line (green - with gate reduction) */}
                            <polyline 
                                points={withReduction.map((p, i) => `${60 + (p.degree - 4) * 25 + 12},${chartHeight + 10 - (Math.min(p.effectiveSpeedup, maxY) / maxY) * chartHeight}`).join(' ')}
                                fill="none"
                                className="stroke-green-400"
                                strokeWidth="2"
                            />
                            {withReduction.map((p, i) => (
                                <circle 
                                    key={`green-${i}`}
                                    cx={60 + (p.degree - 4) * 25 + 12}
                                    cy={chartHeight + 10 - (Math.min(p.effectiveSpeedup, maxY) / maxY) * chartHeight}
                                    r={p.degree === selectedDegree ? 6 : 4}
                                    className="fill-green-400 cursor-pointer"
                                    onClick={() => setSelectedDegree(p.degree)}
                                />
                            ))}

                            {/* Legend */}
                            <g transform={`translate(${chartWidth - 100}, 20)`}>
                                <line x1="0" y1="0" x2="20" y2="0" className="stroke-red-400" strokeWidth="2" />
                                <text x="25" y="4" className="fill-red-400 text-xs">Per-gate cost</text>
                                <line x1="0" y1="15" x2="20" y2="15" className="stroke-green-400" strokeWidth="2" />
                                <text x="25" y="19" className="fill-green-400 text-xs">With gate reduction</text>
                            </g>

                            {/* Axis labels */}
                            <text x={chartWidth / 2 + 60} y={chartHeight + 50} className="fill-gray-400 text-sm" textAnchor="middle">Polynomial Degree</text>
                            <text x="15" y={chartHeight / 2} className="fill-gray-400 text-sm" textAnchor="middle" transform={`rotate(-90, 15, ${chartHeight / 2})`}>Speedup vs Vanilla</text>
                        </svg>
                    </div>

                    {/* Selected degree info */}
                    <div className="grid grid-cols-3 gap-4 mb-6">
                        <div className="bg-gray-700 p-4 rounded-lg">
                            <div className="text-sm text-gray-400">Selected Degree</div>
                            <div className="text-2xl font-bold text-purple-400">d = {selectedDegree}</div>
                        </div>
                        <div className="bg-red-900 p-4 rounded-lg">
                            <div className="text-sm text-gray-400">Per-Gate Cost</div>
                            <div className="text-2xl font-bold text-red-400">
                                {dataPoints.find(p => p.degree === selectedDegree)?.jellyfish.toFixed(2)}x
                            </div>
                            <div className="text-xs text-gray-400">slower than vanilla</div>
                        </div>
                        <div className="bg-green-900 p-4 rounded-lg">
                            <div className="text-sm text-gray-400">Effective Speedup</div>
                            <div className="text-2xl font-bold text-green-400">
                                {withReduction.find(p => p.degree === selectedDegree)?.effectiveSpeedup.toFixed(2)}x
                            </div>
                            <div className="text-xs text-gray-400">with gate reduction</div>
                        </div>
                    </div>

                    {/* Paper insight */}
                    <div className="p-4 bg-gray-700 rounded-lg text-sm">
                        <p className="text-yellow-400 font-semibold mb-2">üìÑ Paper Finding (zkPHIRE Section 6.3):</p>
                        <p className="text-gray-300">
                            "While Jellyfish gates have <span className="text-red-400">higher per-gate cost</span> (more extensions, more terms), 
                            they enable <span className="text-green-400">significant gate reduction</span> for suitable workloads. 
                            At degree 7 with 8x gate reduction (Poseidon hash), net speedup is 3.3x.
                            The crossover where compute overtakes memory occurs around <span className="text-purple-400">degree 18</span>."
                        </p>
                    </div>
                </div>
            );
        };

        // ============================================================
        // CIRCUIT COMPILER DEMO
        // ============================================================
        const CircuitCompiler = () => {
            const [selectedCircuit, setSelectedCircuit] = useState('poseidon');
            const [isCompiling, setIsCompiling] = useState(false);
            const [compiledOps, setCompiledOps] = useState([]);
            const [showVanilla, setShowVanilla] = useState(true);

            const circuits = {
                poseidon: {
                    name: 'Poseidon Hash (1 round)',
                    description: 'ZK-friendly hash using x^5 S-boxes',
                    code: `function poseidon_round(state):
    # S-box layer (x^5)
    for i in 0..WIDTH:
        state[i] = state[i]^5
    
    # Linear layer (MDS matrix)
    state = MDS @ state
    
    # Add round constant
    state = state + RC
    
    return state`,
                    vanillaOps: [
                        { type: 'MUL', desc: 'x¬≤ = x √ó x', count: 3, forEach: 'per element' },
                        { type: 'MUL', desc: 'x‚Å¥ = x¬≤ √ó x¬≤', count: 3, forEach: 'per element' },
                        { type: 'MUL', desc: 'x‚Åµ = x‚Å¥ √ó x', count: 3, forEach: 'per element' },
                        { type: 'MUL', desc: 'MDS row √ó col', count: 9, forEach: 'matrix' },
                        { type: 'ADD', desc: 'MDS accumulate', count: 6, forEach: 'matrix' },
                        { type: 'ADD', desc: 'Add RC', count: 3, forEach: 'per element' },
                    ],
                    jellyfishOps: [
                        { type: 'POW5', desc: 'x‚Åµ native', count: 3, forEach: 'per element' },
                        { type: 'QUAD', desc: 'MDS 4-way', count: 3, forEach: 'matrix' },
                        { type: 'ADD', desc: 'Add RC', count: 3, forEach: 'per element' },
                    ],
                    vanillaTotal: 27,
                    jellyfishTotal: 9,
                },
                ecdsa: {
                    name: 'ECDSA Point Addition',
                    description: 'Elliptic curve point addition for signatures',
                    code: `function ec_add(P1, P2):
    # Compute slope
    dy = P2.y - P1.y
    dx = P2.x - P1.x
    lambda = dy / dx
    
    # Compute result
    x3 = lambda^2 - P1.x - P2.x
    y3 = lambda*(P1.x - x3) - P1.y
    
    return (x3, y3)`,
                    vanillaOps: [
                        { type: 'SUB', desc: 'dy = P2.y - P1.y', count: 1, forEach: '' },
                        { type: 'SUB', desc: 'dx = P2.x - P1.x', count: 1, forEach: '' },
                        { type: 'DIV', desc: 'Œª = dy / dx', count: 1, forEach: '(inv + mul)' },
                        { type: 'MUL', desc: 'Œª¬≤', count: 1, forEach: '' },
                        { type: 'SUB', desc: 'Œª¬≤ - P1.x', count: 1, forEach: '' },
                        { type: 'SUB', desc: 'x3 = ... - P2.x', count: 1, forEach: '' },
                        { type: 'SUB', desc: 'P1.x - x3', count: 1, forEach: '' },
                        { type: 'MUL', desc: 'Œª √ó (P1.x - x3)', count: 1, forEach: '' },
                        { type: 'SUB', desc: 'y3 = ... - P1.y', count: 1, forEach: '' },
                    ],
                    jellyfishOps: [
                        { type: 'EC_ADD', desc: 'Native point add', count: 1, forEach: 'specialized' },
                    ],
                    vanillaTotal: 10,
                    jellyfishTotal: 3,
                },
                mimc: {
                    name: 'MiMC Hash (1 round)',
                    description: 'Minimal multiplicative complexity hash',
                    code: `function mimc_round(x, k, c):
    # MiMC uses x^3 or x^7
    t = x + k + c
    return t^7`,
                    vanillaOps: [
                        { type: 'ADD', desc: 'x + k', count: 1, forEach: '' },
                        { type: 'ADD', desc: '... + c', count: 1, forEach: '' },
                        { type: 'MUL', desc: 't¬≤', count: 1, forEach: '' },
                        { type: 'MUL', desc: 't¬≥', count: 1, forEach: '' },
                        { type: 'MUL', desc: 't‚Å∂', count: 1, forEach: '' },
                        { type: 'MUL', desc: 't‚Å∑ = t‚Å∂ √ó t', count: 1, forEach: '' },
                    ],
                    jellyfishOps: [
                        { type: 'ADD', desc: 'x + k + c', count: 1, forEach: 'packed' },
                        { type: 'POW7', desc: 't^7 native', count: 1, forEach: '' },
                    ],
                    vanillaTotal: 6,
                    jellyfishTotal: 2,
                },
            };

            const circuit = circuits[selectedCircuit];

            const compile = () => {
                setIsCompiling(true);
                setCompiledOps([]);
                
                const ops = showVanilla ? circuit.vanillaOps : circuit.jellyfishOps;
                let delay = 0;
                
                ops.forEach((op, i) => {
                    setTimeout(() => {
                        setCompiledOps(prev => [...prev, { ...op, id: i }]);
                    }, delay);
                    delay += 300;
                });
                
                setTimeout(() => setIsCompiling(false), delay);
            };

            const reduction = circuit.vanillaTotal / circuit.jellyfishTotal;
            const netSpeedup = reduction / 2.4;

            return (
                <div className="p-6 bg-gray-800 rounded-xl">
                    <h2 className="text-2xl font-bold mb-4 text-orange-400">Circuit Compiler Demo</h2>
                    <p className="text-gray-400 mb-4">See how high-level code compiles to gates</p>
                    
                    {/* Circuit selector */}
                    <div className="flex gap-2 mb-6 flex-wrap">
                        {Object.entries(circuits).map(([key, val]) => (
                            <button 
                                key={key}
                                onClick={() => { setSelectedCircuit(key); setCompiledOps([]); }}
                                className={`px-4 py-2 rounded-lg font-semibold transition-all ${
                                    selectedCircuit === key 
                                        ? 'bg-orange-600 scale-105' 
                                        : 'bg-gray-600 hover:bg-gray-500'
                                }`}
                            >
                                {val.name}
                            </button>
                        ))}
                    </div>

                    <div className="grid grid-cols-2 gap-6 mb-6">
                        {/* Source code */}
                        <div className="bg-gray-900 rounded-lg p-4">
                            <div className="flex justify-between items-center mb-3">
                                <h3 className="font-semibold text-green-400">Source Code</h3>
                                <span className="text-xs text-gray-500">{circuit.description}</span>
                            </div>
                            <pre className="code-font text-sm text-gray-300 whitespace-pre-wrap">{circuit.code}</pre>
                        </div>

                        {/* Compiled gates */}
                        <div className="bg-gray-900 rounded-lg p-4">
                            <div className="flex justify-between items-center mb-3">
                                <h3 className="font-semibold text-blue-400">Compiled Gates</h3>
                                <div className="flex gap-2">
                                    <button
                                        onClick={() => { setShowVanilla(true); setCompiledOps([]); }}
                                        className={`px-2 py-1 text-xs rounded ${showVanilla ? 'bg-blue-600' : 'bg-gray-700'}`}
                                    >
                                        Vanilla
                                    </button>
                                    <button
                                        onClick={() => { setShowVanilla(false); setCompiledOps([]); }}
                                        className={`px-2 py-1 text-xs rounded ${!showVanilla ? 'bg-pink-600' : 'bg-gray-700'}`}
                                    >
                                        Jellyfish
                                    </button>
                                </div>
                            </div>
                            
                            <div className="space-y-2 min-h-48">
                                {compiledOps.map((op, i) => (
                                    <div 
                                        key={op.id}
                                        className={`flex items-center gap-2 p-2 rounded animate-compile ${
                                            showVanilla ? 'bg-blue-900' : 'bg-pink-900'
                                        }`}
                                        style={{ animationDelay: `${i * 50}ms` }}
                                    >
                                        <div className={`px-2 py-1 rounded text-xs font-bold ${
                                            op.type === 'MUL' ? 'bg-blue-500' :
                                            op.type === 'ADD' || op.type === 'SUB' ? 'bg-green-500' :
                                            op.type === 'DIV' ? 'bg-yellow-500 text-black' :
                                            op.type === 'POW5' || op.type === 'POW7' ? 'bg-pink-500' :
                                            op.type === 'QUAD' ? 'bg-purple-500' :
                                            'bg-orange-500'
                                        }`}>
                                            {op.type}
                                        </div>
                                        <span className="text-sm text-gray-300">{op.desc}</span>
                                        {op.count > 1 && <span className="text-xs text-gray-500">√ó{op.count}</span>}
                                        {op.forEach && <span className="text-xs text-gray-600">({op.forEach})</span>}
                                    </div>
                                ))}
                                
                                {compiledOps.length === 0 && !isCompiling && (
                                    <div className="text-center text-gray-500 py-8">
                                        Click "Compile" to see gates
                                    </div>
                                )}
                            </div>

                            <button
                                onClick={compile}
                                disabled={isCompiling}
                                className="w-full mt-4 py-2 bg-orange-600 hover:bg-orange-500 rounded-lg font-semibold disabled:opacity-50"
                            >
                                {isCompiling ? '‚öôÔ∏è Compiling...' : '‚ñ∂ Compile'}
                            </button>
                        </div>
                    </div>

                    {/* Comparison */}
                    <div className="grid grid-cols-4 gap-4 mb-6">
                        <div className="bg-blue-900 p-4 rounded-lg text-center">
                            <div className="text-sm text-gray-400">Vanilla Gates</div>
                            <div className="text-3xl font-bold text-blue-400">{circuit.vanillaTotal}</div>
                        </div>
                        <div className="bg-pink-900 p-4 rounded-lg text-center">
                            <div className="text-sm text-gray-400">Jellyfish Gates</div>
                            <div className="text-3xl font-bold text-pink-400">{circuit.jellyfishTotal}</div>
                        </div>
                        <div className="bg-purple-900 p-4 rounded-lg text-center">
                            <div className="text-sm text-gray-400">Reduction</div>
                            <div className="text-3xl font-bold text-purple-400">{reduction.toFixed(1)}√ó</div>
                        </div>
                        <div className={`p-4 rounded-lg text-center ${netSpeedup > 1 ? 'bg-green-900' : 'bg-red-900'}`}>
                            <div className="text-sm text-gray-400">Net Speedup</div>
                            <div className={`text-3xl font-bold ${netSpeedup > 1 ? 'text-green-400' : 'text-red-400'}`}>
                                {netSpeedup.toFixed(2)}√ó
                            </div>
                        </div>
                    </div>

                    {/* Formula */}
                    <div className="p-4 bg-gray-700 rounded-lg text-center font-mono">
                        <div className="text-sm text-gray-400 mb-2">Net Speedup = Gate Reduction √∑ Jellyfish Cost Factor</div>
                        <div className="text-xl">
                            <span className={netSpeedup > 1 ? 'text-green-400' : 'text-red-400'}>{netSpeedup.toFixed(2)}√ó</span>
                            {' = '}
                            <span className="text-purple-400">{reduction.toFixed(1)}√ó</span>
                            {' √∑ '}
                            <span className="text-yellow-400">2.4√ó</span>
                        </div>
                    </div>
                </div>
            );
        };

        // ============================================================
        // PAPER COMPARISON TABLE
        // ============================================================
        const PaperComparison = () => {
            const comparisons = [
                { aspect: 'Publication', zkspeed: '2024', zkphire: '2024' },
                { aspect: 'Focus', zkspeed: 'Fixed SumCheck acceleration', zkphire: 'Programmable polynomial eval' },
                { aspect: 'Gate Support', zkspeed: 'Vanilla (degree 4)', zkphire: 'Vanilla + Jellyfish + Custom' },
                { aspect: 'Polynomial Degree', zkspeed: 'Fixed (optimized for d=4)', zkphire: 'Configurable (d=4 to d=20+)' },
                { aspect: 'MSM Handling', zkspeed: 'Dedicated MSM unit (50% area)', zkphire: 'Shared PE resources' },
                { aspect: 'Memory Architecture', zkspeed: 'Streaming MLE access', zkphire: 'Streaming + random access' },
                { aspect: 'Target Workload', zkspeed: 'Current proof systems', zkphire: 'Future high-degree gates' },
                { aspect: 'Key Innovation', zkspeed: 'Unified PE design', zkphire: 'Runtime-programmable terms' },
                { aspect: 'Bottleneck', zkspeed: 'Memory (at d‚â§10)', zkphire: 'Memory‚ÜíCompute (at d‚â•18)' },
                { aspect: 'Best For', zkspeed: 'Plonk, Groth16', zkphire: 'HyperPlonk, Jellyfish' },
            ];

            return (
                <div className="p-6 bg-gray-800 rounded-xl">
                    <h2 className="text-2xl font-bold mb-4 text-cyan-400">Paper Comparison: zkSpeed vs zkPHIRE</h2>
                    
                    <div className="overflow-x-auto">
                        <table className="w-full text-sm">
                            <thead>
                                <tr className="border-b border-gray-700">
                                    <th className="text-left py-3 px-4 text-gray-400">Aspect</th>
                                    <th className="text-left py-3 px-4 text-blue-400">zkSpeed</th>
                                    <th className="text-left py-3 px-4 text-purple-400">zkPHIRE</th>
                                </tr>
                            </thead>
                            <tbody>
                                {comparisons.map((row, i) => (
                                    <tr key={i} className="border-b border-gray-700 hover:bg-gray-750">
                                        <td className="py-3 px-4 font-semibold text-gray-300">{row.aspect}</td>
                                        <td className="py-3 px-4 text-gray-400">{row.zkspeed}</td>
                                        <td className="py-3 px-4 text-gray-400">{row.zkphire}</td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>

                    <div className="grid grid-cols-2 gap-4 mt-6">
                        <div className="p-4 bg-blue-900 rounded-lg">
                            <h3 className="font-bold text-blue-400 mb-2">When to use zkSpeed approach:</h3>
                            <ul className="text-sm text-gray-300 space-y-1">
                                <li>‚Ä¢ Current-gen proof systems (Plonk, Groth16)</li>
                                <li>‚Ä¢ Fixed, well-known polynomial structures</li>
                                <li>‚Ä¢ Maximum efficiency for specific protocol</li>
                                <li>‚Ä¢ Memory-bound workloads (typical case)</li>
                            </ul>
                        </div>
                        <div className="p-4 bg-purple-900 rounded-lg">
                            <h3 className="font-bold text-purple-400 mb-2">When to use zkPHIRE approach:</h3>
                            <ul className="text-sm text-gray-300 space-y-1">
                                <li>‚Ä¢ Next-gen proof systems (HyperPlonk)</li>
                                <li>‚Ä¢ Custom gates, high-degree polynomials</li>
                                <li>‚Ä¢ Need flexibility for multiple protocols</li>
                                <li>‚Ä¢ Hash-heavy workloads (Poseidon)</li>
                            </ul>
                        </div>
                    </div>
                </div>
            );
        };

        // ============================================================
        // UNDERSTANDING CALCULATOR
        // ============================================================
        const UnderstandingCalculator = () => {
            const [circuitSize, setCircuitSize] = useState(20);
            const [workloadType, setWorkloadType] = useState('hash');
            const [targetLatency, setTargetLatency] = useState(10);

            const workloadReductions = {
                hash: { reduction: 8, name: 'Hash-heavy (Poseidon)', color: 'pink' },
                ec: { reduction: 4, name: 'EC operations', color: 'blue' },
                mixed: { reduction: 5, name: 'Mixed/General', color: 'purple' },
                arithmetic: { reduction: 2, name: 'Simple arithmetic', color: 'gray' },
            };

            const w = workloadReductions[workloadType];
            const n = 2 ** circuitSize;
            
            // Performance estimates
            const vanillaCycles = n * 20; // ~20 cycles per gate
            const jellyfishCycles = (n / w.reduction) * 48; // ~48 cycles per gate (2.4x)
            
            const vanillaTime = vanillaCycles / 1e9 * 1000; // ms at 1GHz
            const jellyfishTime = jellyfishCycles / 1e9 * 1000;
            
            const netSpeedup = vanillaTime / jellyfishTime;
            const recommended = netSpeedup > 1.2 ? 'Jellyfish' : netSpeedup < 0.8 ? 'Vanilla' : 'Either';
            
            // Hardware requirements to hit target latency
            const requiredBandwidth = (n * 32 * 3) / (targetLatency / 1000) / 1e9; // GB/s
            const requiredPEs = Math.ceil(vanillaCycles / (targetLatency * 1e6));

            return (
                <div className="p-6 bg-gray-800 rounded-xl">
                    <h2 className="text-2xl font-bold mb-4 text-yellow-400">"Prove Your Understanding" Calculator</h2>
                    <p className="text-gray-400 mb-4">Input your requirements, get recommendations</p>
                    
                    {/* Inputs */}
                    <div className="grid grid-cols-3 gap-4 mb-6">
                        <div className="bg-gray-700 p-4 rounded-lg">
                            <label className="block text-sm text-gray-400 mb-2">
                                Circuit Size: 2^{circuitSize} = {n.toLocaleString()} gates
                            </label>
                            <input 
                                type="range" min="16" max="26" value={circuitSize}
                                onChange={(e) => setCircuitSize(Number(e.target.value))}
                                className="w-full"
                            />
                        </div>
                        <div className="bg-gray-700 p-4 rounded-lg">
                            <label className="block text-sm text-gray-400 mb-2">Workload Type</label>
                            <select 
                                value={workloadType}
                                onChange={(e) => setWorkloadType(e.target.value)}
                                className="w-full bg-gray-600 rounded p-2"
                            >
                                {Object.entries(workloadReductions).map(([key, val]) => (
                                    <option key={key} value={key}>{val.name}</option>
                                ))}
                            </select>
                        </div>
                        <div className="bg-gray-700 p-4 rounded-lg">
                            <label className="block text-sm text-gray-400 mb-2">
                                Target Latency: {targetLatency} ms
                            </label>
                            <input 
                                type="range" min="1" max="100" value={targetLatency}
                                onChange={(e) => setTargetLatency(Number(e.target.value))}
                                className="w-full"
                            />
                        </div>
                    </div>

                    {/* Results */}
                    <div className="grid grid-cols-2 gap-6 mb-6">
                        {/* Performance comparison */}
                        <div className="bg-gray-700 p-4 rounded-lg">
                            <h3 className="font-semibold mb-3 text-cyan-400">Performance Analysis</h3>
                            <div className="space-y-3">
                                <div className="flex justify-between">
                                    <span className="text-gray-400">Vanilla time:</span>
                                    <span className="font-bold text-blue-400">{vanillaTime.toFixed(2)} ms</span>
                                </div>
                                <div className="flex justify-between">
                                    <span className="text-gray-400">Jellyfish time:</span>
                                    <span className="font-bold text-pink-400">{jellyfishTime.toFixed(2)} ms</span>
                                </div>
                                <div className="flex justify-between">
                                    <span className="text-gray-400">Gate reduction:</span>
                                    <span className="font-bold text-purple-400">{w.reduction}√ó</span>
                                </div>
                                <div className="flex justify-between border-t border-gray-600 pt-2">
                                    <span className="text-gray-400">Net speedup:</span>
                                    <span className={`font-bold ${netSpeedup > 1 ? 'text-green-400' : 'text-red-400'}`}>
                                        {netSpeedup.toFixed(2)}√ó
                                    </span>
                                </div>
                            </div>
                        </div>

                        {/* Hardware requirements */}
                        <div className="bg-gray-700 p-4 rounded-lg">
                            <h3 className="font-semibold mb-3 text-orange-400">Hardware Requirements</h3>
                            <div className="space-y-3">
                                <div className="flex justify-between">
                                    <span className="text-gray-400">Min bandwidth:</span>
                                    <span className="font-bold">{requiredBandwidth.toFixed(0)} GB/s</span>
                                </div>
                                <div className="flex justify-between">
                                    <span className="text-gray-400">Min PEs (vanilla):</span>
                                    <span className="font-bold">{Math.min(requiredPEs, 999)}</span>
                                </div>
                                <div className="flex justify-between">
                                    <span className="text-gray-400">Estimated area:</span>
                                    <span className="font-bold">~{Math.ceil(requiredPEs * 0.5)} mm¬≤</span>
                                </div>
                                <div className="flex justify-between">
                                    <span className="text-gray-400">Estimated power:</span>
                                    <span className="font-bold">~{Math.ceil(requiredPEs * 2)} W</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Recommendation */}
                    <div className={`p-6 rounded-lg text-center ${
                        recommended === 'Jellyfish' ? 'bg-pink-900' :
                        recommended === 'Vanilla' ? 'bg-blue-900' : 'bg-gray-700'
                    }`}>
                        <div className="text-sm text-gray-400 mb-2">Recommendation</div>
                        <div className="text-3xl font-bold mb-2">{recommended}</div>
                        <div className="text-sm text-gray-300">
                            {recommended === 'Jellyfish' && `${w.reduction}√ó gate reduction overcomes 2.4√ó per-gate cost ‚Üí ${netSpeedup.toFixed(2)}√ó net speedup`}
                            {recommended === 'Vanilla' && `Gate reduction (${w.reduction}√ó) doesn't overcome Jellyfish overhead (2.4√ó)`}
                            {recommended === 'Either' && 'Performance is similar - choose based on other factors'}
                        </div>
                    </div>
                </div>
            );
        };

        // ============================================================
        // MAIN APP
        // ============================================================
        const App = () => {
            const [activeTab, setActiveTab] = useState('figure9');

            const tabs = [
                { id: 'figure9', name: 'zkSpeed Fig 9', icon: 'üìä', color: 'blue' },
                { id: 'figure11', name: 'zkPHIRE Fig 11', icon: 'üìà', color: 'purple' },
                { id: 'compiler', name: 'Circuit Compiler', icon: '‚öôÔ∏è', color: 'orange' },
                { id: 'comparison', name: 'Paper Comparison', icon: 'üìÑ', color: 'cyan' },
                { id: 'calculator', name: 'Calculator', icon: 'üßÆ', color: 'yellow' },
            ];

            return (
                <div className="min-h-screen">
                    {/* Header */}
                    <header className="bg-gradient-to-r from-blue-900 via-purple-900 to-orange-900 p-6">
                        <h1 className="text-4xl font-bold text-center mb-2">
                            Paper Analysis & Circuit Compiler
                        </h1>
                        <p className="text-center text-gray-300">
                            Reproducing key figures and demonstrating circuit compilation
                        </p>
                    </header>

                    {/* Navigation */}
                    <nav className="bg-gray-800 border-b border-gray-700 sticky top-0 z-10">
                        <div className="flex overflow-x-auto">
                            {tabs.map(tab => (
                                <button
                                    key={tab.id}
                                    onClick={() => setActiveTab(tab.id)}
                                    className={`px-6 py-4 font-semibold whitespace-nowrap transition-all ${
                                        activeTab === tab.id
                                            ? `bg-gray-700 text-${tab.color}-400 border-b-2 border-${tab.color}-400`
                                            : 'text-gray-400 hover:text-white hover:bg-gray-700'
                                    }`}
                                >
                                    <span className="mr-2">{tab.icon}</span>
                                    {tab.name}
                                </button>
                            ))}
                        </div>
                    </nav>

                    {/* Content */}
                    <main className="container mx-auto p-6 max-w-6xl">
                        {activeTab === 'figure9' && <ZkSpeedFigure9 />}
                        {activeTab === 'figure11' && <ZkPHIREFigure11 />}
                        {activeTab === 'compiler' && <CircuitCompiler />}
                        {activeTab === 'comparison' && <PaperComparison />}
                        {activeTab === 'calculator' && <UnderstandingCalculator />}
                    </main>

                    {/* Footer with navigation */}
                    <footer className="bg-gray-800 p-4 text-center text-gray-400 text-sm">
                        <div className="flex justify-center gap-4 mb-2">
                            <a href="index.html" className="text-cyan-400 hover:underline">Basic Visualizations</a>
                            <span>|</span>
                            <a href="advanced.html" className="text-purple-400 hover:underline">Advanced (MSM, NTT)</a>
                            <span>|</span>
                            <span className="text-orange-400">Paper Analysis (current)</span>
                        </div>
                        Demonstrating deep understanding of zkSpeed & zkPHIRE papers
                    </footer>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
